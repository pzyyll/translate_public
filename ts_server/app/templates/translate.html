<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸€ä¸ªç¥å¥‡çš„ç¿»è¯‘å°ç«™ğŸ˜Š</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body, html {
            height: 100%;
            margin: 0;
        }
        .container {
            max-width: 100%;
            height: 100vh;
            padding: 70px; /* ä¿æŒåŸæœ‰çš„ä¸Šè¾¹è·ï¼Œæ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ */
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* æ”¹ä¸ºä»é¡¶éƒ¨å¼€å§‹å¸ƒå±€ */
            overflow: auto; /* æ·»åŠ æ»šåŠ¨æ¡ä»¥é€‚åº”è¶…å‡ºå®¹å™¨é«˜åº¦çš„å†…å®¹ */
        }
        .row {
            flex-grow: 1;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            margin: 0 -15px;
        }
        .col {
            height: auto;
            padding: 0 15px;
            margin-bottom: 10px; /* æˆ–æ ¹æ®ä½ çš„è®¾è®¡éœ€æ±‚è°ƒæ•´ */
        }
        .form-control {
            height: 150px; /* åˆå§‹é«˜åº¦ */
            resize: none;
            overflow-y: auto; /* å…è®¸å†…å®¹è¶…å‡ºæ—¶æ»šåŠ¨ */
        }
        .extra-content {
            text-align: right;
            padding-top: 5px; /* è°ƒæ•´ä¸æ–‡æœ¬æ¡†çš„é—´è· */
            font-size: 0.5rem; /* è°ƒæ•´å­—ä½“å¤§å° */
            color: #9a9fa3; /* è®¾ç½®é¢œè‰²ä¸ºæµ…ç°è‰² */
            font-style: italic; /* è®¾ç½®æ–‡æœ¬ä¸ºæ–œä½“ */
        }
        @media (max-width: 767px) {
            .row {
                flex-grow: 0;
                flex-direction: column;
                margin: 0; /* ç¡®ä¿.rowå…ƒç´ ä¸ä¼šå¯¹é—´è·äº§ç”Ÿå½±å“ */
            }
            .container {
                padding: 30px;
            }
            .col:last-child {
                margin-bottom: 0; /* ç§»é™¤æœ€åä¸€ä¸ªå…ƒç´ çš„åº•éƒ¨è¾¹è· */
            }
            .form-control {
                /* ç§»é™¤å›ºå®šé«˜åº¦çš„è®¾ç½®ï¼Œè®©å®ƒæ ¹æ®å†…å®¹è‡ªé€‚åº” */
                height: auto;
                min-height: 100px; /* è®¾ç½®ä¸€ä¸ªæœ€å°é«˜åº¦ */
                max-height: 45vh; /* æœ€å¤§é«˜åº¦é™åˆ¶ä¸ºè§†å£é«˜åº¦çš„45% */
                overflow-y: auto; /* è¶…å‡ºæ—¶å…è®¸æ»šåŠ¨ */
            }
            .extra-content {
                padding-top: 1px; /* è°ƒæ•´ä¸æ–‡æœ¬æ¡†çš„é—´è· */
                font-size: 0.3rem; /* è°ƒæ•´å­—ä½“å¤§å° */
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col">
            <textarea class="form-control" id="sourceText" placeholder="Text to be translated..." control-id="ControlID-1">{{ source_text }}</textarea>
        </div>
        <div class="col">
            <textarea class="form-control" id="mirroredText" placeholder="Translation text will appear here..." readonly="" control-id="ControlID-2">{{ target_text }}</textarea>
            <div id="extraContent" class="extra-content">{{ extra_content }}</div> <!-- é¢å¤–å†…å®¹çš„å®¹å™¨ -->
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        function adjustTextareaHeightV2() {
            sourceText = document.getElementById('sourceText');
            mirroredText = document.getElementById('mirroredText');

            if (window.innerWidth >= 767) { // å®½å±æ—¶æ ¹æ®å†…å®¹è°ƒæ•´é«˜åº¦
                sourceText.style.height = '1px';
                mirroredText.style.height = '1px';
                adjustHeight = Math.max(sourceText.scrollHeight, mirroredText.scrollHeight, 150);
                adjustHeight = Math.min(adjustHeight, 2000); // é™åˆ¶é«˜åº¦ä¸è¶…è¿‡å±å¹•é«˜åº¦
                sourceText.style.height = adjustHeight + 'px';
                mirroredText.style.height = sourceText.style.height;
            } else { // å°å±æ—¶ä½¿ç”¨CSSè§„åˆ™
                sourceText.style.height = '1px';
                mirroredText.style.height = '1px';
                adjustHeight = Math.max(sourceText.scrollHeight, mirroredText.scrollHeight, 100);
                adjustHeight = Math.min(adjustHeight, window.innerHeight * 0.45); // é™åˆ¶é«˜åº¦ä¸è¶…è¿‡å±å¹•é«˜åº¦çš„45%
                sourceText.style.height = adjustHeight + 'px';
                mirroredText.style.height = sourceText.style.height;
            }
        }

        let timeoutId = null;
        const delay = 500; // å»¶è¿Ÿ500æ¯«ç§’åå‘é€è¯·æ±‚

        $('#sourceText').on('input', function() {
            adjustTextareaHeightV2();
            const text = $(this).val();
            clearTimeout(timeoutId); // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨

            if (!text) {
                $('#mirroredText').val('');
                $('#extraContent').text('');
                return;
            }

            timeoutId = setTimeout(async function() {
                try {
                    const response = await $.ajax({
                        url: '/translate/translate_text',
                        method: 'POST',
                        contentType: 'application/json',
                        data: JSON.stringify({ text: text }),
                    });
                    $('#mirroredText').val(response.translate_text);
                    adjustTextareaHeightV2(); // è°ƒæ•´ç¿»è¯‘æ–‡æœ¬æ¡†çš„é«˜åº¦
                    $('#extraContent').text(response.api_type); // æ˜¾ç¤ºé¢å¤–ä¿¡æ¯
                    if (response.redirect_url) {
                        // å¦‚æœè¿”å›äº†é‡å®šå‘URLï¼Œæ›´æ–°æµè§ˆå™¨URL
                        history.pushState(null, '', response.redirect_url);
                    } 
                } catch (error) {
                    console.error('Error processing text:', error);
                    // å¤„ç†é”™è¯¯æˆ–è€…åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                }
            }, delay);
        
        });

        // åˆå§‹åŒ–æ—¶è°ƒæ•´é«˜åº¦
        adjustTextareaHeightV2();

        // ç›‘å¬çª—å£å°ºå¯¸å˜åŒ–ï¼Œé€‚åº”å±å¹•å˜åŒ–
        $(window).resize(function() {
            // if (window.innerWidth < 767) {
            //     $('.form-control').css('height', ''); // å°å±æ—¶ç§»é™¤é«˜åº¦æ ·å¼ï¼Œä½¿ç”¨CSSè§„åˆ™
            // } else {
            //     adjustTextareaHeightV2();
            // }
            adjustTextareaHeightV2();
        });
    });
</script>
</body>
</html>